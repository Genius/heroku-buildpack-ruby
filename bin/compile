#!/usr/bin/env bash

# This will print every command as it's being executed
set -x

BUILD_DIR=$1
BIN_DIR=$(cd "$(dirname "$0")" || exit; pwd)

# Define the path to your tarball
custom_ruby_tarball_path="$(dirname "$BIN_DIR")/vendor/ruby-custom/ruby-2.6.9.tar.gz"

# Define the path where the tarball should be extracted
ruby_install_dir="$BUILD_DIR/vendor/ruby-custom"

# Show the path we are about to use
echo "Attempting to extract tarball from: $custom_ruby_tarball_path"

# List the contents of the directory containing the tarball
ls -l "$(dirname "$custom_ruby_tarball_path")"

# Try to extract the tarball
tar -xzf "$custom_ruby_tarball_path" -C "$ruby_install_dir"

# Print the exit status of the tar command
echo "Tar command exit status: $?"

# List the contents of the destination directory
ls -l "$ruby_install_dir"

# The script should now exit with the error